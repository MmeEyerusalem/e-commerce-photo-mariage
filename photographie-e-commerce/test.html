
-------------------code from page authentification-------------------------

if($client) {

if(password_verify($password, $client['password'])){
  debug("Password verified!");
  $_SESSION['user'] = $client;
          
    header("location:". RACINE_SITE ."profil.php");
    // exi²t;  // pour execute redirection

    }else {
          $message = "Le mot de passe incorrecte";
    }
}else{
$message = "Email or password incorrect";
}


-------------------------code from page galerie prive--------------------------

require_once "inc/functions.inc.php";


$pdo =  connexionBdd();
$sql= ("SELECT* FROM client_images ORDER BY id_client_image "); //pour afficher le nouvelle affiche commence 1eme line DESC.
$request = $pdo->prepare($sql);
$request->execute();

if (isset($_GET['id_client_image']) == ':id_client_image') {

header("location:" . RACINE_SITE . "galerieprive.php");
}

<!-- 


<main class="container mt-2 mb-2">
    <h1>Welcome to your gallery private</h1>
    <article class=" p-2 m-2">
        <?php
        $galerieprives = $request->fetchAll(PDO::FETCH_ASSOC);
        foreach ($galerieprives as $galerieprive) {
        ?>
        <div class="p-2">
            <img src="<?= $galerieprive['photo_id'] ?>" alt="..." >
        </div>
        <?php
        }
        ?>
    </article>
    <div>
        <a href="#" class=" btn btn-primary">Téléchargement</a>
    </div>
</main>
 -->


// First Code Snippet (Login Script)
// ... [previous code]
$stmt = $pdo->prepare("SELECT * FROM users WHERE email = :email");
$stmt->execute(['email' => $email]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);
if ($user && password_verify($password, $user['password'])) {
    $_SESSION['user_id'] = $user['id'];
    // ... [redirection based on role]
}

// Second Code Snippet (checkClient Function)
function checkClient(string $email, string $password): mixed {
    $pdo = connexionBdd();
    $request = $pdo->prepare("SELECT * FROM user WHERE email = :email");
    $request->execute([':email' => $email]);
    $user = $request->fetch();
    if ($user && password_verify($password, $user['password'])) {
        return $user;
    } else {
        return false;
    }
}

// ... [previous code]

// User login process
if (isset($_POST['login'])) {
    $email = $_POST['email'];
    $password = $_POST['password'];

    // Prepare and execute the query
    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = :email");
    $stmt->execute(['email' => $email]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);

    // Verify the password
    if ($user && password_verify($password, $user['password'])) {
        // Password is correct, create user session
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['role'] = $user['role']; // Store the user's role in the session

        // Redirect based on role
        if ($user['role'] === 'admin') {
            header('Location: dashboard.php');
        } else if ($user['role'] === 'client') {
            header('Location: profile.php'); // Redirect to the client's profile page
        }
        exit;
    } else {
        // Authentication failed
        echo 'Incorrect email or password.';
    }
}
// ...


// First Code Snippet (Login Script)
// ... [previous code]
$request = $pdo->prepare("SELECT * FROM clients WHERE email = :email");
$request->execute(['email' => $email]);
$client = $request->fetch(PDO::FETCH_ASSOC);
if ($client && password_verify($password, $client['password'])) {
    $_SESSION['client_id'] = $client['id'];
    // ... [redirection based on role]
}

// Second Code Snippet (checkClient Function)
function checkClient(string $email, string $password): mixed {
    $pdo = connexionBdd();
    $request = $pdo->prepare("SELECT * FROM user WHERE email = :email");
    $request->execute([':email' => $email]);
    $user = $request->fetch();
    if ($user && password_verify($password, $user['password'])) {
        return $user;
    } else {
        return false;
    }
}



___________________________________projet perso_______________________________

<?php if (connexionBdd() && ['ROLE_ADMIN']) { ?>

    <h2>Ajouter un article</h2>
    <form action="#" method="POST" class="mb-5 alert alert-success">

        <div class="mb-3">
            <label for="photo">Photo de l'article</label>
            <input type="text" name="photo" id="photo" placeholder="URL de l'image" class="form-control">
        </div>

        <input type="submit" value="Ajouter un article" class="btn btn-outline-light">

    </form>
<?php } ?>


if (estConnecte() && estAdmin()) {
    echo '<a href="projetperso.php?action=suppression&id_art_galerie=' . $art_galerie['id_art_galerie'] . '" class="btn btn-danger" onclick="return(confirm(\'Êtes-vous sûr de vouloir supprimer cet article?\'))">Supprimer l\'article</a>';
}

Ajout art photo
    if (!empty($_POST)) { // vérification que le formulaire n'est pas vide
        $_POST['photo'] = htmlspecialchars($_POST['photo']);

        
        /* préparation de la requête d'insertion */
        $insertion = $pdo->prepare("INSERT INTO art_galerie  (photo) VALUES  (:photo) ");

        /* je fais correspondre les marqueurs avec ce qui se trouve dans mon formulaire et dans $_SESSION */
        $insertion->execute(array(
            ':photo' => $_POST['photo'],
        ));
    }

    //  Suppresion de l'article

    if (isset($_GET['action']) && $_GET['action'] == 'suppression' && isset($_GET['id_article'])) {
        $delete = $pdo->prepare("DELETE FROM art_galerie WHERE id_art_galerie = :id_art_galerie");
        $delete->execute(array(
            ':id_art_galerie' => $_GET['id_art_galerie'],
        ));

        if ($delete->rowCount() == 0) {
            $contenu .= '<div class="alert alert-danger">Erreur de suppression pour l\'photo' . $_GET['id_art_galerie'] . '</div>';
        } else {
            $contenu .= '<div class="alert alert-success">L\'photo . $_GET['id_art_galerie'] . ' a bien été supprimé</div>';
        }
    }

    if (empty($info)) {

        if (empty($info)) {
        $nom = htmlentities(trim($_POST['nom']));
        $price = (float) htmlentities(trim($_POST['price']));
        $description = htmlentities(trim($_POST['description']));
        $stock = (int) $_POST['stock'];

        // La super global $_FILES à un indice "image" qui correspond au 'name' de l'input type"file" du formulaire ainsi qu'un indice "name" qui contient le nom du fichier en cours de télechargement  
        $image = $_FILES['image']['name'];

         // On enregistre le fichier image qui se trouve à l'adresse contenue dans $_FILES['image']['tmp_name'] vers la destination qui est le dossier "img" à l'adresse "../assets/nom_du_fichier.jpg".
        copy($_FILES['image']['tmp_name'], '../assets/img/' . $image);
        //debug($image)

        if (isset($_GET['action']) && $_GET['action'] == 'update' && isset($_GET['id_produit'])) {
            // $id = $_GET['id_produit'];

            move_uploaded_file($_FILES['image']['tmp_name'], '../assets/img/' . $image); // copy

            updateProduit($idProduit, $nom, $image, $price, $description, $stock);

         } else {
        copy($_FILES['image']['tmp_name'], '../assets/img/' . $image);
        
        addProduit($nom, $image, $price, $description, $stock);
        }

    header('location:dashboard.php?films_php');
    }
}       
   
}